
module test.test;

vec = load fvector;
ss = load syntheticstream;

testStream n is number -> 'a  = ss.precalculated 1000 (vec.vector [1..n]);

compare obtained expected =
    if obtained == expected then
        true;
    else
        println "** expected: \(expected)\n   obtained: \(obtained)";
        false;
    fi;

select f = fold do r x: if f x then x::r else r fi done [];

failedTests testHash =
    select (!= "")
       (mapHash do name f:
            if f () then "" else
                println "Test \(name) failed";
                name;
            fi 
        done testHash);
        
runTests group testHash =
   (failed = failedTests testHash;
    println "\(group): \(length testHash - length failed)/\(length testHash) tests passed";
    if not empty? failed then
        println "\(group): Failed tests [\(length failed)]: \(strJoin ' ' failed)";
    fi);

declare tests is hash<string, () -> boolean> -> 'a =
    { tests };

{
    testStream, compare, failedTests, runTests, declare
}

